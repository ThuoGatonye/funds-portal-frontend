<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit Logs - Funds Group</title>
    <link rel="icon" type="image/x-icon" href="images/favicon.png">

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/3.0.2/css/buttons.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/3.0.2/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/3.0.1/css/responsive.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/3.0.1/css/responsive.bootstrap5.min.css">

    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <header>
        <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
            <i class="fas fa-bars"></i>
        </button>
        <a href="index.html" class="logo-link">
            <span class="logo-text">FUNDS GROUP</span>
        </a>
        <div class="header-right">
            <div class="user-info">
                Welcome, John Doe
            </div>
            <a href="login.html" class="logout-btn">Logout</a>
        </div>
    </header>

    <div class="main-content">
        <aside class="sidebar">
            <h2>Navigation</h2>
            <ul>
                <li><a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="transactions.html"><i class="fas fa-exchange-alt"></i> Transactions</a></li>
                <li><a href="#" class="dropdown-toggle"><i class="fas fa-users"></i> Clients</a>
                    <ul class="submenu">
                        <li><a href="add-client.html">Add Client</a></li>
                        <li><a href="manage-clients.html">Manage Clients</a></li>
                    </ul>
                </li>
                <li><a href="#" class="dropdown-toggle"><i class="fas fa-cogs"></i> Settings</a>
                    <ul class="submenu">
                        <li><a href="user-profile.html">User Profile</a></li>
                        <li><a href="system-settings.html">System Settings</a></li>
                    </ul>
                </li>
                <li><a href="reports.html"><i class="fas fa-chart-line"></i> Reports</a></li>
                <li><a href="audit-logs.html" class="active"><i class="fas fa-clipboard-list"></i> Audit Logs</a></li>
                <li><a href="support.html"><i class="fas fa-question-circle"></i> Support</a></li>
            </ul>
        </aside>

        <main class="dashboard-content">
            <div class="page-header-controls">
                <h1>Audit Logs</h1>
                <div class="header-buttons">
                    <button id="toggleFiltersBtn" class="btn btn-primary"><i class="fas fa-filter"></i> Advanced Search</button>
                </div>
            </div>

            <section class="filters-section collapsed">
                <div class="filters-content">
                    <div class="filter-group">
                        <label for="filterUser">User:</label>
                        <input type="text" id="filterUser" placeholder="e.g., John Doe">
                    </div>
                    <div class="filter-group">
                        <label for="filterAction">Action:</label>
                        <select id="filterAction">
                            <option value="">All Actions</option>
                            <option value="Login">Login</option>
                            <option value="Logout">Logout</option>
                            <option value="Create Client">Create Client</option>
                            <option value="Update Client">Update Client</option>
                            <option value="Delete Client">Delete Client</option>
                            <option value="Process Transaction">Process Transaction</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterDateRange">Date Range:</label>
                        <input type="text" id="filterDateRange" placeholder="Select Date Range">
                    </div>
                    <div class="filter-group">
                        <label for="filterIPAddress">IP Address:</label>
                        <input type="text" id="filterIPAddress" placeholder="e.g., 192.168.1.1">
                    </div>
                    <div class="filter-group">
                        <button id="applyFiltersBtn" class="btn btn-primary"><i class="fas fa-check"></i> Apply Filters</button>
                        <button id="clearFiltersBtn" class="btn btn-secondary clear-btn"><i class="fas fa-times"></i> Clear Filters</button>
                    </div>
                </div>
            </section>

            <section class="data-table-container">
                <table id="auditLogsTable" class="table table-striped table-hover dt-responsive nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Timestamp</th>
                            <th>User</th>
                            <th>Action</th>
                            <th>Details</th>
                            <th>IP Address</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>2025-07-11 10:00:00</td>
                            <td>John Doe</td>
                            <td>Login</td>
                            <td>Successful login</td>
                            <td>192.168.1.1</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>2025-07-11 10:05:30</td>
                            <td>Jane Smith</td>
                            <td>Create Client</td>
                            <td>New client 'Acme Corp' added</td>
                            <td>192.168.1.2</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>2025-07-11 10:15:45</td>
                            <td>Admin User</td>
                            <td>Update Client</td>
                            <td>Client 'Acme Corp' details updated</td>
                            <td>192.168.1.3</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>2025-07-11 11:00:00</td>
                            <td>John Doe</td>
                            <td>Process Transaction</td>
                            <td>Transaction ID: 54321, Amount: $1,500</td>
                            <td>192.168.1.1</td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>2025-07-11 11:30:10</td>
                            <td>Jane Smith</td>
                            <td>Logout</td>
                            <td>User logged out</td>
                            <td>192.168.1.2</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>2025-07-11 12:00:00</td>
                            <td>Admin User</td>
                            <td>System Settings Change</td>
                            <td>Updated security protocols</td>
                            <td>192.168.1.3</td>
                        </tr>
                        <tr>
                            <td>7</td>
                            <td>2025-07-11 13:00:00</td>
                            <td>John Doe</td>
                            <td>View Report</td>
                            <td>Accessed financial summary report</td>
                            <td>192.168.1.1</td>
                        </tr>
                         <tr>
                            <td>8</td>
                            <td>2025-07-10 09:30:00</td>
                            <td>System Bot</td>
                            <td>Automated Backup</td>
                            <td>Database backup completed successfully</td>
                            <td>10.0.0.5</td>
                        </tr>
                        <tr>
                            <td>9</td>
                            <td>2025-07-10 14:45:00</td>
                            <td>Sarah Connor</td>
                            <td>Password Reset</td>
                            <td>Password for 'Sarah Connor' reset</td>
                            <td>192.168.1.4</td>
                        </tr>
                        <tr>
                            <td>10</td>
                            <td>2025-07-10 16:00:00</td>
                            <td>Michael Blue</td>
                            <td>Delete Client</td>
                            <td>Client 'Old Corp' removed</td>
                            <td>192.168.1.5</td>
                        </tr>
                        <tr>
                            <td>11</td>
                            <td>2025-07-09 08:00:00</td>
                            <td>John Doe</td>
                            <td>Login Failed</td>
                            <td>Incorrect password entered</td>
                            <td>192.168.1.1</td>
                        </tr>
                        <tr>
                            <td>12</td>
                            <td>2025-07-09 08:05:00</td>
                            <td>John Doe</td>
                            <td>Login</td>
                            <td>Successful login after retry</td>
                            <td>192.168.1.1</td>
                        </tr>
                    </tbody>
                </table>
            </section>
        </main>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datatables/2.0.8/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/2.0.8/dataTables.bootstrap5.min.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.0.2/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.0.2/buttons.bootstrap5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/3.0.2/buttons.html5.min.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/responsive/3.0.1/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/3.0.1/responsive.bootstrap5.min.js"></script>

    <script>
        // DataTables and Filters Initialization
        $(document).ready(function() {
            console.log('Document ready. Initializing DataTables...'); // Added for debugging
            var auditLogsTable = $('#auditLogsTable').DataTable({
                paging: true,
                searching: true,
                ordering: true,
                info: true,
                lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
                responsive: false, // Explicitly set to false to prevent row collapsing
                scrollX: true,     // Enable horizontal scrolling for the table
                dom: 'lfrtip', // Updated DOM to remove 'B' (buttons) from default DataTables placement

                // Removed buttons config from here as we're injecting them separately
            });
            console.log('DataTables initialization attempt complete.'); // Added for debugging

            // Initialize and place DataTables Export Buttons
            // This is done separately to place them exactly where we want (in .header-buttons)
            new $.fn.dataTable.Buttons(auditLogsTable, {
                buttons: [
                    {
                        extend: 'collection',
                        text: '<i class="fas fa-file-export"></i> Export',
                        className: 'btn btn-primary', // Apply Bootstrap button styling
                        buttons: [
                            { extend: 'csv', text: '<i class="fas fa-file-csv"></i> CSV' },
                            { extend: 'excel', text: '<i class="fas fa-file-excel"></i> Excel' },
                            { extend: 'pdf', text: '<i class="fas fa-file-pdf"></i> PDF' }
                        ]
                    }
                ]
            });
            // Append the generated DataTables buttons to our desired div
            auditLogsTable.buttons().container().appendTo($('.header-buttons'));

            // Toggle Advanced Filters
            $('#toggleFiltersBtn').on('click', function() {
                $('.filters-section').toggleClass('collapsed');
                $('.filters-content').toggleClass('show');
                $(this).text(function(i, text) {
                    return text === 'Advanced Search' ? 'Hide Advanced Search' : 'Advanced Search';
                });
            });

            // Mobile menu toggle
            $('.mobile-menu-toggle').on('click', function() {
                console.log('Mobile menu toggle clicked'); // Debug log
                $('.sidebar').toggleClass('show-sidebar');
            });

            // Optional: Hide sidebar if clicking outside when active (for mobile)
            $(document).on('click', function(e) {
                if ($(window).width() <= 768) { // Only apply for mobile screen sizes
                    // Check if the click was outside the sidebar and the toggle button
                    if (!$('.sidebar').is(e.target) && $('.sidebar').has(e.target).length === 0 &&
                        !$('.mobile-menu-toggle').is(e.target) && $('.mobile-menu-toggle').has(e.target).length === 0 &&
                        $('.sidebar').hasClass('show-sidebar')) {
                        $('.sidebar').removeClass('show-sidebar');
                    }
                }
            });

            // Flatpickr initialization for date range filters
            flatpickr("#filterDateRange", {
                mode: "range",
                dateFormat: "Y-m-d",
                wrap: true // Enable wrapper for calendar icon
            });
        });

        // Dropdown menu toggle for sidebar (Existing functionality)
        $(document).ready(function() {
            $('.sidebar .dropdown-toggle').on('click', function(e) {
                e.preventDefault(); // Prevent default link behavior
                e.stopPropagation(); // Stop event bubbling to document click
                var $this = $(this);
                var $submenu = $this.next('.submenu');

                // Toggle visibility of the next submenu
                $submenu.toggleClass('show');

                // If this submenu is shown, hide other open submenus at the same level
                $('.sidebar .submenu').not($submenu).removeClass('show');
            });

            // Close submenus if clicking outside them, but not on their toggles
            $(document).on('click', function(e) {
                $('.sidebar .submenu.show').each(function() {
                    var $submenu = $(this);
                    // Check if click is outside the submenu and its direct toggle
                    if (!$submenu.is(e.target) && $submenu.has(e.target).length === 0 &&
                        !$submenu.prev('.dropdown-toggle').is(e.target)) {
                        $submenu.removeClass('show');
                    }
                });
            });
        });
    </script>
</body>
</html>
